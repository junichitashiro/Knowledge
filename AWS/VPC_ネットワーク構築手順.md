# VPC_ネットワーク構築手順

下記構成のVPCネットワークを作成する

## VPC（Virtual Private Cloud）

* リージョン：東京
* CIDR ブロック：10.0.0.0/16

## サブネット

* パブリックサブネット
  * Webサーバーを配置する
  * CIDR ブロック：10.0.10.0/24

* プライベートサブネット
  * データベースサーバーを配置する
  * CIDR ブロック：10.0.20.0/24

## アベイラビリティゾーン

* 上記のサブネットを同一のアベイラビリティゾーンに設定する
* アベイラビリティゾーンを分けるのはサーバーの冗長化を検討する段階になったらでよい

***

## １．VPCを作成する

AWS上に仮想ネットワークを作成する

### リージョンを選択する

* 上部メニューからプルダウンで __アジアパシフィック(東京)__ のリージョンを選択する

***

### VPCを作成する

VPCをネットワーク単位で分割して利用しやすくする

1. VPCダッシュボードのメニューから __VPC__ をクリックする  
  →VPCの一覧（未作成の場合でもデフォルトが存在する）が表示される

2. __VPCを作成__ をクリックする

3. 以下の入力と設定をして __作成__ をクリックする
    * 名前タグ：magenta-magenta-vpc
    * IPv4 CIDR ブロック：10.0.0.0/16
    * IPv6 CIDR ブロック：IPv6 CIDR ブロックなし
    * テナンシー：デフォルト
        * 物理ハードウェアを専有するオプション、料金も割高になるので不要

4. 完了画面が表示されるので __閉じる__ をクリックする  
  →一覧に作成されたVPCが表示される

***

## ２．サブネットを作成する

### パブリックサブネット

1. 左メニューから __サブネット__ をクリックする  
  →サブネットの一覧（未作成の場合でもデフォルトが存在する）が表示される

2. __サブネットを作成__ をクリックする

3. 以下の入力と設定をして __作成__ をクリックする
    * VPC ID：magenta-magenta-vpc
    * サブネット名：magenta-magenta-public-subnet-1a
    * アベイラビリティーゾーン：ap-northeast-1a
    * IPv4 CIDR ブロック：10.0.10.0/24

4. 完了画面が表示されるので __閉じる__ をクリックする  
  →一覧に作成されたサブネットが表示される

### プライベートサブネット

1. 左メニューから __サブネット__ をクリックする  
  →サブネットの一覧（未作成の場合でもデフォルトが存在する）が表示される

2. __サブネットの作成__ をクリックする

3. 以下の入力と設定をして __作成__ をクリックする
    * VPC ID：magenta-magenta-vpc
    * サブネット名：magenta-magenta-private-subnet-1a
    * アベイラビリティーゾーン：ap-northeast-1a
    * IPv4 CIDR ブロック：10.0.20.0/24

4. 完了画面が表示されるので __閉じる__ をクリックする  
  →一覧に作成されたサブネットが表示される

***

## ３．ルーティングを設定する

サブネットからインターネットに接続できるようにする

### インターネットゲートウェイを作成する

1. 左メニューから __インターネットゲートウェイ__ をクリックする

2. __インターネットゲートウェイの作成__ をクリックする

3. 名前タグ（__magenta-magenta-igw__）を入力して __インターネットゲートウェイの作成__ をクリックする

### VPCにアタッチする

1. 一覧から作成したインターネットゲートウェイを選択して __アクション__ メニューから __VPCにアタッチ__ を選択する

2. 作成済みのVPC（__magenta-magenta-vpc__）を選択して __インターネットゲートウェイのアタッチ__ をクリックする

### ルートテーブルを作成する

1. 左メニューから __ルートテーブル__ をクリックする

2. __ルートテーブルの作成__ をクリックする

3. 以下の入力と設定をして __作成__ をクリックする
    * 名前タグ：magenta-magenta-public-route
    * VPC：magenta-magenta-vpc

4. 一覧に戻って作成したルートテーブルを選択して __サブネットの関連付け__ タブの __サブネットの関連付けの編集__ をクリックする

5. パブリックサブネット（__magenta-magenta-public-subnet-1a__）を選択して __保存__ をクリックする

### デフォルトルートをインターネットゲートウェイに設定する

パブリックサブネットからインターネットへの接続を可能にする

1. 一覧から作成したルートテーブルを選択して __ルート__ タブの __ルートの編集__ をクリックする

2. __ルートの追加__ をクリックし、以下の入力と設定をして __ルートの保存__ をクリックする
    * 送信先：0.0.0.0/0
    * ターゲット：Internet Gateway → magenta-magenta-igw
