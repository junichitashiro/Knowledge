# 特徴量の選択と作成

## 特徴量の選択
* 特徴量が多すぎると過学習のリスクになる
* 機械学習の精度を高めるためには重要な特徴量だけを選択する必要がある

## 特徴量選択手法
* 単変量解析
  * 目的変数と各説明変数を1対1で確認し取捨選択する
  * 分散分析など
* モデルベース選択
  * モデルにとっての各変数の重要度を算出し取捨選択する
  * ツリー系機械学習手法の重要度をみる
* 反復選択
  * 特徴量を増減させながらモデルを生成し良い特徴量を探索する
  * ステップワイズ法など

## 特徴量の作成

ここでは[SIGNATEの練習問題データ](https://signate.jp/competitions/24/data)を使用している

## 事前準備
* ライブラリのインポート
* __LinearRegression__ は線形回帰用のライブラリ
  ```python
  import pandas as pd
  import numpy as np
  from matplotlib import pyplot as plt
  %matplotlib inline
  from sklearn.linear_model import LinearRegression as LR
  ```

* CSVデータの読み込み
  ```python
  train = pd.read_csv("train.csv")
  test = pd.read_csv("test.csv")
  sample = pd.read_csv("sample.csv",header=None)
  ```

## データの確認
* 売上の折れ線グラフを確認
  ```python
  train["y"].plot(figsize=(12,4))
  ```

* 学習データの内容を確認
  ```python
  train.head()
  ```

## 新しい特徴量の追加

ここでは時系列に相当する新しい特徴量を作成してみる

## 新しいカラムの追加
* 学習データのdatetimeから年月を取り出し、新たなカラムとして追加する
  ```python
  # ハイフンで分割したdatetimeの1つ目の要素を変数yearに格納
  train["year"] = train["datetime"].apply(lambda x :x.split("-")[0])

  # 同じく2つ目の要素を変数monthに格納
  train["month"] = train["datetime"].apply(lambda x :x.split("-")[1])
  ```

* 評価データにも同様の処理をする
  ```python
  test["year"] = test["datetime"].apply(lambda x :x.split("-")[0])
  test["month"] = test["datetime"].apply(lambda x :x.split("-")[1])
  ```

## データ型の変換
* 機械学習に適したデータ型になっているか確認する
  ```python
  train.info()
  ```

* 追加した列のデータの型を整数（int）に変換する
  ```python
  train["year"] = train["year"].astype(np.int)
  train["month"] = train["month"].astype(np.int)
  test["year"] = test["year"].astype(np.int)
  test["month"] = test["month"].astype(np.int)
  ```

## ここからは通常の重回帰モデル作成と同様に進める

* 学習データから説明変数と目的変数を抽出する
  ```python
  trainX = train[["year","month"]]
  y = train["y"]
  ```

* 評価データから説明変数を抽出する
  ```python
  testX = test[["year","month"]]
  ```

## モデルの準備
* モデルを表す変数を用意する
  ```python
  model = LR()
  ```

## モデルの作成
* 重回帰モデルを作成する
  ```python
  model.fit(trainX,y)
  ```

* モデルの傾きと切片を確認する
  ```python
  model.coef_
  model.intercept_
  ```

* predict関数を使った予測結果を変数に代入する
  ```python
  pred = model.predict(testX)
  ```

## モデルの評価
* SIGNATEで評価する形式にデータを加工する
* sampleファイルのカラム[1]に、予測結果を代入する
  ```python
  sample.head()

  sample[1] = pred
  ```

* sampleをCSVファイルに書き出す
  ```python
  sample.to_csv("submit.csv",index=None,header=None)
  ```

* 書き出したファイルを[SIGNATE](https://signate.jp/competitions/24/data)に投稿して評価を確認する



